<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Untitled Document</title>
    <script src="https://d3js.org/d3.v3.js"></script>
    <style>
        #bodylight {
            background: #eee;
        }
        
        .axis path,
        .axis line {
            fill: none;
            stroke: black;
            shape-rendering: auto;
        }
        
        .axis text {
            font-size: 12px;
        }
        
        #tooltiplight {
            position: absolute;
            /* left: 20px; */
            /* top:  100px; */
            background: #fff;
            width: 150px;
            height: auto;
            padding: 0px 10px;
            border-radius: 5px;
            box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.3);
        }
        
        #tooltiplight.hidden {
            display: none;
        }
    </style>
</head>
<h1>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;景氣對策信號燈</h1>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;資料來源:國家發展委員會

<body id="bodylight">
    <div id="tooltiplight" class="hidden">
        <p><strong id="score">Hello</strong></p>
        <p id="date">tooltip</p>
    </div>
    <script>
        var w = 900;
        var h = 600;
        var padding = 90;
        var letterList = ["A", "B", "C", "D", "E"];
        svg();
        d3.csv("lightnumber.csv", function (dataSet) {
            bind(dataSet);
            render(dataSet);
            btnList(dataSet);
        });

        function svg() {
            d3.select("#bodylight").append("svg").attr({
                id: "svglight",
                width: w,
                height: h
            });
            d3.select("#svglight").append("g").append("rect").attr({
                width: "100%",
                height: "100%",
                fill: "white"
            });
            d3.select("#svglight").append("g").attr("id", "axisX");
            d3.select("#svglight").append("g").attr("id", "axisY");
        }

        function bind(dataSet) {
            var selection = d3.select("#svglight").selectAll("circle").data(dataSet);
            selection.enter().append("circle");
            selection.exit().remove();
        }

        function render(dataSet) {
            //比例尺們 xScale, yScale, rScale, fScale
            var xScale = d3.time.scale().domain([new Date(d3.min(dataSet, function (d) {
                return new Date(d.date);
            })), new Date(d3.max(dataSet, function (d) {
                return new Date(d.date);
            }))]).range([padding, w - padding]);
            var yScale = d3.scale.linear().domain([0, d3.max(dataSet, function (d) {
                return +d.score;
            })]).range([h - padding, padding]);
            var rScale = d3.scale.linear().domain([d3.min(dataSet, function (d) {
                return +d.score;
            }), d3.max(dataSet, function (d) {
                return +d.score;
            })]).range([5, 20]);
            var fScale = d3.scale.category20();
            //開始畫圈圈
            d3.selectAll("circle").attr({
                cx: function (d) {
                    return xScale(new Date(d.date));
                },
                cy: function (d) {
                    return yScale(+d.score);
                },
                r: function (d) {
                    return rScale(+d.score);
                },
                fill: function (d) {
                    return fScale(letterList.indexOf(d.cid));
                }
            }).on("mouseover", function (d) {
                var xPos = parseFloat(d3.select(this).attr("cx")) + 12;
                var yPos = parseFloat(d3.select(this).attr("cy")) + 12;
                d3.select("#tooltiplight").style({
                    left: xPos + "px",
                    top: yPos + "px"
                });
                d3.select("#date").text(d.date);
                d3.select("#score").text(d.score);
                d3.select("#tooltiplight").classed("hidden", false);
            }).on("mouseout", function (d) {
                d3.select("#tooltiplight").classed("hidden", true);
            });
            //開始畫x,y軸線 
            var xAxis = d3.svg.axis().scale(xScale).orient("bottom");
            var yAxis = d3.svg.axis().scale(yScale).orient("left");
            d3.select("#svglight").select("g#axisY").attr("class", "axis").attr("transform", "translate(" + (padding - 10) + ",0)").call(yAxis);
            d3.select("#svglight").select("g#axisX").attr("class", "axis").attr("transform", "translate(0," + (h - padding + 10) + ")").call(xAxis);
        }

        function btnList(dataSet) {
            //cityArr: 行業別陣列(包含重複項目)           
            var scoreArr = dataSet.map(function (d) {
                return d.score;
            });
            //uniqueVariableArr: 行業別陣列(無重複項目) 
            var uniqueScoreArr = unique(scoreArr);
            //filterIndustryArr: 行業別陣列(去除空白項目) 
            var filterScoreArr = uniqueScoreArr.filter(function (d) {
                return d != "";
            });
            //畫出按鈕們
            var selection = d3.select("#bodylight").append("div").selectAll("input").data(filterScoreArr);
            selection.enter().append("input").attr({
                type: "button",
                value: function (d) {
                    return d;
                }
            }).on("click", function (d) {
                //當行業別按鈕按下時執行
                update(d);
            });

            function update(scoreName) {
                //過濾行業別符合者
                var newDataSet = dataSet.filter(function (d) {
                    return d.score === scoreName;
                });
                //重新整理bind,render
                //???
                bind(newDataSet);
                render(newDataSet);
            }

            function unique(array) {
                var n = [];
                for (var i = 0; i < array.length; i++) {
                    if (n.indexOf(array[i]) == -1) {
                        n.push(array[i]);
                    }
                }
                return n;
            }
        }
    </script>
</body>
<h2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;資料來源:國家發展委員會</h2>

</html>